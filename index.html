<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="manifest" href="manifest.json" />
<link rel="apple-touch-icon" href="icon.png" />
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–µ—Å–∞ —à—Ç–∞–Ω–≥–∏</title>
<style>
  body {
  background: #121212;
  color: #E0E0E0;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  padding: 20px;
  text-align: center;
  transition: background-color 0.3s, color 0.3s;
}
input[type=number], input[type=text], select {
  padding: 12px 16px;
  font-size: 1.2em;
  width: 220px;
  border: 2px solid #424242;
  border-radius: 14px;
  margin-bottom: 20px;
  outline: none;
  background: #1E1E1E;
  color: #E0E0E0;
}
button {
  background: #fff;
  color: #121212;
  border: none;
  border-radius: 14px;
  padding: 14px 28px;
  font-size: 1.3em;
  cursor: pointer;
  transition: background-color 0.3s, color 0.3s;
}
button:hover {
  background: #2979FF;
  color: #fff;
}
#result, #resultDetailed, #recordsList, #benchResults {
  margin-top: 30px;
  font-size: 1.3em;
  font-weight: 600;
  line-height: 1.4;
  white-space: pre-wrap;
}
#warning {
  margin-top: 15px;
  color: #ff5252;
  font-weight: 700;
}
.menu-button {
  position: fixed;
  top: 10px;
  left: 10px;
  font-size: 28px;
  cursor: pointer;
  user-select: none;
  z-index: 110;
  color: #E0E0E0;
}
#sidebar {
  position: fixed;
  top: 0;
  left: -250px;
  width: 240px;
  height: 100%;
  background: #1E1E1E;
  box-shadow: 2px 0 5px rgba(0,0,0,0.2);
  padding: 20px;
  box-sizing: border-box;
  transition: left 0.3s;
  z-index: 100;
  overflow-y: auto;
  color: #E0E0E0;
}
#sidebar.open {
  left: 0;
}
#sidebar h2 {
  margin-top: 0;
  color: #E0E0E0;
}
#sidebar ul {
  list-style: none;
  padding: 0;
}
#sidebar ul li {
  padding: 10px 5px;
  cursor: pointer;
  border-radius: 8px;
  color: #E0E0E0;
}
#sidebar ul li:hover:not(.disabled) {
  background: #424242;
}
#sidebar ul li.disabled {
  color: #9E9E9E;
  cursor: default;
}
h1 {
  margin-top: 60px;
}
#sidebar ul li.disabled:hover {
  background: none;
}
#recordForm input, #recordForm select {
  width: 180px;
  margin: 5px;
  background: #1E1E1E;
  color: #E0E0E0;
  border: 1px solid #424242;
}
table {
  margin: 20px auto;
  border-collapse: collapse;
  width: 90%;
  max-width: 700px;
  background: #1E1E1E;
  color: #E0E0E0;
}
table, th, td {
  border: 1px solid #424242;
}
th, td {
  padding: 10px;
  text-align: center;
}
th {
  background-color: #232323;
  color: #E0E0E0;
}
#toggleViewBtn {
  margin-top: 10px;
  padding: 8px 20px;
  font-size: 1em;
  border-radius: 12px;
  background: #2979FF;
  color: #fff;
  border: none;
}
#warmupResult {
  font-size: 1.2em;
  font-weight: 700;
  margin-top: 30px;
  white-space: pre-wrap;
}
#sidebarOverlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.3);
  z-index: 99;
  display: none;
}
#sidebar.open + #sidebarOverlay {
  display: block;
}
/* Telegram-like chat */
#chatBox {
  background: #1E1E1E;
  border-radius: 18px;
  padding: 16px 8px 70px 8px;
  min-height: 300px;
  max-height: 400px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.telegram-message {
  display: flex;
  align-items: flex-end;
  margin: 2px 0;
  max-width: 80%;
}
.telegram-message.me {
  align-self: flex-end;
  flex-direction: row-reverse;
}
.telegram-bubble {
  background: #232323;
  border-radius: 18px;
  padding: 6px 12px;
  font-size: 1.1em;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  margin: 0 6px;
  word-break: break-word;
  position: relative;
  min-width: 40px;
  max-width: 350px;
  text-align: left;
  line-height: 1.2;
  color: #E0E0E0;
  border: 1px solid #424242;
}
.telegram-bubble > div:first-child {
  margin-bottom: 0;
}
.telegram-message.me .telegram-bubble {
  background: #1E1E1E;
  color: #E0E0E0;
  border: 1px solid #424242;
}
.telegram-message:not(.me) .telegram-bubble {
  background: #232323;
  color: #E0E0E0;
  border: 1px solid #424242;
}
.telegram-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  object-fit: cover;
  border: 1.5px solid #424242;
}
.telegram-meta {
  font-size: 0.85em;
  color: #9E9E9E;
  margin-top: 2px;
  text-align: right;
}
#chatInput {
  width: 70%;
  padding: 12px;
  border-radius: 18px;
  border: 1.5px solid #424242;
  font-size: 1.1em;
  margin-right: 8px;
  outline: none;
  background: #232323;
  color: #E0E0E0;
}
#sendChatBtn {
  padding: 12px 22px;
  border-radius: 18px;
  font-size: 1.1em;
  background: #2979FF;
  color: #fff;
  border: none;
  margin-right: 8px;
}
#sendChatBtn:hover {
  background: #1565c0;
}
#changeNickBtn {
  padding: 12px 18px;
  border-radius: 18px;
  font-size: 1.1em;
  background: #232323;
  color: #E0E0E0;
  border: 1px solid #424242;
}
@media (max-width: 600px) {
  #chatBox { max-height: 250px; }
  #chatInput { width: 55%; }
}
.telegram-bubble {
  transition: background 0.7s;
}
</style>  
  </head>
  <body>
  <div class="menu-button" onclick="toggleMenu()">‚ò∞</div>

  <div id="sidebar">
    <h2>–ú–µ–Ω—é</h2>
    <ul>
      <li onclick="selectMode('plates')">ü•û –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±–ª–∏–Ω–æ–≤</li>
      <li onclick="selectMode('bench')">üí™ –†–∞–∑–æ–≤—ã–π –∂–∏–º –ª—ë–∂–∞</li>
      <li onclick="selectMode('warmup')">üèãÔ∏è‚Äç‚ôÇÔ∏è –†–∞–∑–º–∏–Ω–∫–∞ –Ω–∞ –ø—Ä–æ—Ö–æ–¥–∫—É</li>
      <li onclick="selectMode('records')">üèÜ –õ–∏—á–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã</li>
      <li onclick="selectMode('chat')">üí¨ –ß–∞—Ç</li>
      <li class="disabled">üìä –ì—Ä–∞—Ñ–∏–∫–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</li>
      <li class="disabled">üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</li>
    </ul> 
  </div>
  <div id="sidebarOverlay" onclick="toggleMenu()" style="display:none;"></div>
  <div id="modeContent">
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD7ZdXxWmSmth10PB4g3kbXtMASa_yLQrw",
      authDomain: "calculatorbench.firebaseapp.com",
      projectId: "calculatorbench",
      storageBucket: "calculatorbench.firebasestorage.app",
      messagingSenderId: "79133455556",
      appId: "1:79133455556:web:1ddc2a8df716d382fa4591"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <script>
 // --- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ userId –∏ userName ---
    function getUserId() {
      let id = localStorage.getItem('chatUserId');
      if (!id) {
        if (window.crypto && crypto.randomUUID) {
          id = crypto.randomUUID();
        } else {
          id = 'id-' + Math.random().toString(36).substr(2, 16);
        }
        localStorage.setItem('chatUserId', id);
      }
      return id;
    }

    function getUserName() {
      let name = localStorage.getItem('chatUserName');
      if (!name) {
        name = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º:');
        if (!name) name = '–ì–æ—Å—Ç—å';
        localStorage.setItem('chatUserName', name);
      }
      return name;
    }
    // --- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ userAvatar ---
    function getUserAvatar() {
      let avatar = localStorage.getItem('chatUserAvatar');
      if (!avatar) {
        avatar = prompt('–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞—à—É –∞–≤–∞—Ç–∞—Ä–∫—É (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π):');
        if (!avatar) {
          avatar = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(getUserName());
        }
        localStorage.setItem('chatUserAvatar', avatar);
      }
      return avatar;
    }
    // --- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —á–∞—Ç–∞ ---
    async function sendMessage(text) {
  const userId = getUserId();
  const userName = getUserName();
  const userAvatar = getUserAvatar();
  await db.collection('chatMessages').add({
    userId,
    userName,
    userAvatar,
    text,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

    function renderChatMessage(msg) {
  const isMe = msg.userId === getUserId();
  const msgDiv = document.createElement('div');
  msgDiv.className = 'telegram-message' + (isMe ? ' me' : '');

  const avatarUrl = msg.userAvatar || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(msg.userName || '–ì–æ—Å—Ç—å');
  const avatar = document.createElement('img');
  avatar.className = 'telegram-avatar';
  avatar.src = avatarUrl;

  const bubble = document.createElement('div');
  bubble.className = 'telegram-bubble';
  bubble.innerHTML = `
    <div style="font-weight:600;margin-bottom:2px;">${msg.userName || '–ì–æ—Å—Ç—å'}</div>
    <div>${msg.text}</div>
    <div class="telegram-meta">
      ${msg.timestamp && msg.timestamp.toDate ? msg.timestamp.toDate().toLocaleTimeString().slice(0,5) : ''}
    </div>
  `;

  // –í–ª–æ–∂–∏–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
  if (isMe) {
    msgDiv.appendChild(bubble);
    msgDiv.appendChild(avatar);
  } else {
    msgDiv.appendChild(avatar);
    msgDiv.appendChild(bubble);
  }

  // –î–æ–±–∞–≤–∏–º –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
  msgDiv.style.marginBottom = '4px';

  document.getElementById('chatBox').appendChild(msgDiv);
  document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
}
  </script>

  <script>
    const plates = [20, 15, 10, 5, 2.5, 1.25];
    const maxPlatesPerType = 7;
    const barWeight = 20;

    let currentMode = 'plates';
    

    const savedMode = localStorage.getItem('lastMode');
if (savedMode) currentMode = savedMode;

  // –ù–æ–≤—ã–π —Ñ–ª–∞–≥ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤
  let recordsViewAsTable = false;

  function toggleMenu() {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  sidebar.classList.toggle('open');
  overlay.style.display = sidebar.classList.contains('open') ? 'block' : 'none';
}
    function selectMode(mode) {
  currentMode = mode;
  localStorage.setItem('lastMode', mode);
  toggleMenu();
  renderMode();
}

    function renderMode() {
      const container = document.getElementById('modeContent');
      container.innerHTML = '';

      if(currentMode === 'plates'){
        container.innerHTML = `
          <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–µ—Å–∞ —à—Ç–∞–Ω–≥–∏</h1>
          <p>–í–≤–µ–¥–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π –≤–µ—Å (–≤ –∫–≥):</p>
          <input type="number" id="weightInput" min="${barWeight}" step="0.25" value="100" />
          <br/>
          <button id="platesBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –±–ª–∏–Ω—ã</button>
          <div id="warning"></div>
          <div id="result"></div>
          <div id="resultDetailed"></div>
        `;
        document.getElementById('platesBtn').addEventListener('click', calculatePlates);
      } else if(currentMode === 'bench'){
        container.innerHTML = `
          <h1>–†–∞—Å—á—ë—Ç —Ä–∞–∑–æ–≤–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ –≤ –∂–∏–º–µ –ª—ë–∂–∞</h1>
          <label>–í–µ—Å —à—Ç–∞–Ω–≥–∏ –≤ –∂–∏–º–µ –ª—ë–∂–∞: </label><br/>
          <input type="number" id="benchWeight" min="1" step="0.1" value="50" /> –∫–≥<br/><br/>
          <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π —Å —ç—Ç–∏–º –≤–µ—Å–æ–º: </label><br/>
          <input type="number" id="benchReps" min="1" max="20" step="1" value="10" /> —Ä–∞–∑<br/><br/>
          <button id="benchBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
          <div id="benchResults"></div>
        `;
        document.getElementById('benchBtn').addEventListener('click', calculateBenchMax);
      } else if(currentMode === 'warmup'){
  container.innerHTML = `
    <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–∑–º–∏–Ω–∫–∏ –Ω–∞ –ø—Ä–æ—Ö–æ–¥–∫—É</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ:</p>
    <select id="exerciseSelect">
      <option value="bench">–ñ–∏–º –ª—ë–∂–∞</option>
      <option value="deadlift">–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞</option>
      <option value="squat">–ü—Ä–∏—Å–µ–¥</option>
    </select>
    <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –º–∞–∫—Å–∏–º—É–º (–≤ –∫–≥):</p>
    <input type="number" id="warmupWeight" min="${barWeight}" step="0.25" value="120" />
    <br/>
    <button id="warmupBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–º–∏–Ω–∫—É</button>
    <pre id="warmupResult" style="white-space: pre-wrap; margin-top:10px;"></pre>
  `;

  document.getElementById('warmupBtn').addEventListener('click', function() {
    const maxWeight = parseFloat(document.getElementById('warmupWeight').value);
    const exercise = document.getElementById('exerciseSelect').value;

    if (isNaN(maxWeight) || maxWeight < barWeight) {
      document.getElementById('warmupResult').textContent = `–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å —Å —É—á—ë—Ç–æ–º –≥—Ä–∏—Ñ–∞: ${barWeight} –∫–≥`;
      return;
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –≤–µ—Å–∞ —Å —É—á—ë—Ç–æ–º —à–∞–≥–∞ 2.5 (–±–ª–∏–Ω—ã)
    function roundPlate(weight) {
      return Math.round(weight / 2.5) * 2.5;
    }

    // –ñ–∏–º –ª—ë–∂–∞ ‚Äî —Ä–∞–∑–º–∏–Ω–∫–∞ –∏ –ø–æ–ø—ã—Ç–∫–∏ (–ø—Ä–∏–º–µ—Ä)
    const benchWarmup = [
  { percent: 0.3, reps: 10 },  // –æ–±—ã—á–Ω–æ –Ω–∏–∂–µ %, —á—Ç–æ–±—ã —Ä–∞–∑–æ–≥—Ä–µ—Ç—å—Å—è –ø–ª–µ—á–∞–º
  { percent: 0.5, reps: 8 },
  { percent: 0.7, reps: 5 },
  { percent: 0.85, reps: 3 },
  { percent: 0.95, reps: 1 },
];

    const benchAttempts = [
  { percent: 1.0, color: 'üü©', desc: '–ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞' },
  { percent: 1.03, color: 'üü®', desc: '–≤—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ (–µ—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–∏–ª—ã)' },
  { percent: 1.05, color: 'üî¥', desc: '–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ä–∏—Å–∫–æ–≤–∞—è' },
];

    // –°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞ ‚Äî —Ä–∞–∑–º–∏–Ω–∫–∞ –∏ –ø–æ–ø—ã—Ç–∫–∏
const deadliftWarmup = [
  { percent: 0.4, reps: 8 },
  { percent: 0.6, reps: 5 },
  { percent: 0.75, reps: 3 },
  { percent: 0.9, reps: 2 },
  { percent: 0.95, reps: 1 },
];

const deadliftAttempts = [
  { percent: 1.0, color: 'üü©', desc: '–ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞' },
  { percent: 1.05, color: 'üü®', desc: '–≤—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ (–µ—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–∏–ª—ã)' },
  { percent: 1.1, color: 'üî¥', desc: '–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ä–∏—Å–∫–æ–≤–∞—è' },
];

    // –ü—Ä–∏—Å–µ–¥ ‚Äî —Ä–∞–∑–º–∏–Ω–∫–∞ –∏ –ø–æ–ø—ã—Ç–∫–∏ (–ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º)
    const squatWarmup = [
      { percent: 0.4, reps: 10 },
      { percent: 0.6, reps: 5 },
      { percent: 0.8, reps: 3 },
      { percent: 0.9, reps: 2 },
      { percent: 0.95, reps: 1 },
    ];

    const squatAttempts = [
      { percent: 1.0, color: 'üü©', desc: '–ø–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞' },
      { percent: 1.05, color: 'üü®', desc: '–≤—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ (–µ—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—à—å —Å–∏–ª—ã)' },
      { percent: 1.1, color: 'üî¥', desc: '–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ä–∏—Å–∫–æ–≤–∞—è' },
    ];

    let result = '';

    if (exercise === 'bench') {
  result += `üí™ –ñ–ò–ú –õ–Å–ñ–ê ‚Äî —Ä–∞–∑–º–∏–Ω–∫–∞:\n`;
  benchWarmup.forEach(set => {
    const w = roundPlate(maxWeight * set.percent);
    result += `${set.reps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π —Å ${w} –∫–≥\n`;
  }); 
  result += `\n–ü–æ–ø—ã—Ç–∫–∏:\n`;
  benchAttempts.forEach(attempt => {
  const w = roundPlate(maxWeight * attempt.percent);
  result += `${attempt.color} ${w} –∫–≥ ‚Äî ${attempt.desc}\n`;
});
} else if (exercise === 'deadlift') {
  result += `üèãÔ∏è –°–¢–ê–ù–û–í–ê–Ø –¢–Ø–ì–ê ‚Äî —Ä–∞–∑–º–∏–Ω–∫–∞:\n`;
  deadliftWarmup.forEach(set => {
    const w = roundPlate(maxWeight * set.percent);
    result += `${set.reps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π —Å ${w} –∫–≥\n`;
  });
  result += `\n–ü–æ–ø—ã—Ç–∫–∏:\n`;
  deadliftAttempts.forEach(attempt => {
    const w = roundPlate(maxWeight * attempt.percent);
    if (w <= maxWeight + 20) {
      result += `${attempt.color} ${w} –∫–≥ ‚Äî ${attempt.desc}\n`;
    }   
  });
} else if (exercise === 'squat') {
  result += `üèãÔ∏è –ü–†–ò–°–ï–î ‚Äî —Ä–∞–∑–º–∏–Ω–∫–∞:\n`;
  squatWarmup.forEach(set => {
    const w = roundPlate(maxWeight * set.percent);
    result += `${set.reps} –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π —Å ${w} –∫–≥\n`;
  });
  result += `\n–ü–æ–ø—ã—Ç–∫–∏:\n`;
  squatAttempts.forEach(attempt => {
    const w = roundPlate(maxWeight * attempt.percent);
    result += `${attempt.color} ${w} –∫–≥ ‚Äî ${attempt.desc}\n`;
  });
}

    document.getElementById('warmupResult').textContent = result;
  });
} else if(currentMode === 'records'){
        container.innerHTML = `
          <h1>–õ–∏—á–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã</h1>
          <form id="recordForm">
            <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" required />
            <input type="number" id="recordWeight" placeholder="–í–µ—Å (–∫–≥)" min="1" step="0.1" required />
            <input type="number" id="bodyWeight" placeholder="–í–µ—Å —Ç–µ–ª–∞ (–∫–≥)" min="1" step="0.1" required />
            <select id="exerciseType">
              <option value="bench">–ñ–∏–º –ª—ë–∂–∞</option>
              <option value="squat">–ü—Ä–∏—Å–µ–¥</option>
              <option value="deadlift">–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞</option>
              <option value="curl">–°—Ç—Ä–æ–≥–∏–π –±–∏—Ü–µ–ø—Å</option>
            </select>
            <br/>
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥</button>
          </form>
          <div id="recordsList"></div>
        `;
        

        document.getElementById('recordForm').onsubmit = saveRecord;
        loadRecords();
      } else if(currentMode === 'chat'){
        container.innerHTML = `
          <h1>–ß–∞—Ç</h1>
          <div id="chatBox"></div>
<div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
  <input type="text" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
  <button id="sendChatBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  <button id="changeNickBtn">–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</button>
</div>
        `;
        // –°–º–µ–Ω–∞ –Ω–∏–∫–∞
        document.getElementById('changeNickBtn').addEventListener('click', () => {
  const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –Ω–∏–∫–Ω–µ–π–º:');
  if (newName) {
    localStorage.setItem('chatUserName', newName);
    const newAvatar = prompt('–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–æ–≤—É—é –∞–≤–∞—Ç–∞—Ä–∫—É (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π):');
    if (newAvatar) {
      localStorage.setItem('chatUserAvatar', newAvatar);
    } else {
      localStorage.setItem('chatUserAvatar', 'https://ui-avatars.com/api/?name=' + encodeURIComponent(newName));
    }
    alert(`–ù–∏–∫–Ω–µ–π–º –∏ –∞–≤–∞—Ç–∞—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω—ã!`);
  }
});

        document.getElementById('sendChatBtn').addEventListener('click', async () => {
          const input = document.getElementById('chatInput');
          const text = input.value.trim();
          if (text) {
            await sendMessage(text);
            input.value = '';
          }
        });

        // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        db.collection('chatMessages').orderBy('timestamp')
          .onSnapshot(snapshot => {
            snapshot.docChanges().forEach(change => {
              if (change.type === 'added') {
                renderChatMessage(change.doc.data());
              }
            });
          });
      }
    }

    function calculatePlates() {
      document.getElementById('warning').textContent = "";
      document.getElementById('result').textContent = "";
      document.getElementById('resultDetailed').textContent = "";

      let target = parseFloat(document.getElementById('weightInput').value);
      if (isNaN(target) || target < barWeight) {
        document.getElementById('warning').textContent = `–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å —Å —É—á—ë—Ç–æ–º –≥—Ä–∏—Ñ–∞: ${barWeight} –∫–≥`;
        return;
      }

      let platesToUse = (target - barWeight) / 2; // –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
      if (platesToUse < 0) {
        document.getElementById('warning').textContent = "–í–µ—Å –º–µ–Ω—å—à–µ –≤–µ—Å–∞ –≥—Ä–∏—Ñ–∞!";
        return;
      }

      let plateCount = {};
      for (const plate of plates) {
        plateCount[plate] = 0;
      }

      for (const plate of plates) {
        while (platesToUse >= plate - 0.001 && plateCount[plate] < maxPlatesPerType) {
          platesToUse -= plate;
          plateCount[plate]++;
        }
      }

      if (platesToUse > 0.001) {
        document.getElementById('warning').textContent = "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ –Ω–∞–±—Ä–∞—Ç—å –∑–∞–¥–∞–Ω–Ω—ã–π –≤–µ—Å –±–ª–∏–Ω–∞–º–∏.";
      }

      let result = Object.entries(plateCount)
        .filter(([_, c]) => c > 0)
        .map(([p, c]) => `${c} x ${p} –∫–≥`)
        .join(", ");

      if (!result) result = "–¢–æ–ª—å–∫–æ –≥—Ä–∏—Ñ ‚Äî " + barWeight + " –∫–≥";

      document.getElementById('result').textContent = `–ù—É–∂–Ω–æ –Ω–∞–¥–µ—Ç—å –±–ª–∏–Ω—ã —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã:\n${result}`;
    }

    // –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á—ë—Ç–∞ 1–ü–ú –≤ –∂–∏–º–µ –ª—ë–∂–∞
    function calculateBenchMax() {
      const weight = parseFloat(document.getElementById('benchWeight').value);
      const reps = parseInt(document.getElementById('benchReps').value);
      if(isNaN(weight) || isNaN(reps) || weight <= 0 || reps <= 0){
        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!');
        return;
      }

      const formulas = {
        Epley: weight * (1 + reps / 30),
        Lombardi: weight * Math.pow(reps, 0.10),
        OConner: weight * (1 + reps / 40),
        Mayhew: (100 * weight) / (52.2 + 41.9 * Math.exp(-0.055 * reps)),
        Wathan: (100 * weight) / (48.8 + 53.8 * Math.exp(-0.075 * reps)),
        Schwartz: weight * (1 + reps / 30),
        Lander: (100 * weight) / (101.3 - 2.67123 * reps)
      };

      let resStr = "–†–∞—Å—á—ë—Ç –æ–¥–Ω–æ–ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ (–∫–≥):\n";
      for(const f in formulas){
        resStr += `${f}: ${formulas[f].toFixed(1)}\n`;
      }
      document.getElementById('benchResults').textContent = resStr;
    }

    // Firestore ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥
      async function saveRecord(e) {
  e.preventDefault();

  const name = document.getElementById('name').value.trim();
  const weight = parseFloat(document.getElementById('recordWeight').value);
  const bodyWeight = parseFloat(document.getElementById('bodyWeight').value);
  const type = document.getElementById('exerciseType').value;

  // –í–æ—Ç —Ç—É—Ç –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É:
  if (!name || isNaN(weight) || weight <= 0 || isNaN(bodyWeight) || bodyWeight <= 0) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π.');
    return;  // –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–≤–µ—Ä–Ω—ã–µ
  }

  // –î–∞–ª–µ–µ –∏–¥–µ—Ç –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É
  try {
    await db.collection('records').add({
      name,
      weight,
      bodyWeight,
      type,
      date: new Date().toISOString(),
    });
    alert('–†–µ–∫–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
    location.reload();
  } catch (error) {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∫–æ—Ä–¥–∞: ' + error.message);
  }
}

    // Firestore ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã
    async function loadRecords() {
  const container = document.getElementById('recordsList');
  container.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';

  try {
    const snapshot = await db.collection('records').get();
    const records = snapshot.docs.map(doc => doc.data());

    if (records.length === 0) {
      container.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤.';
      return;
    }

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–∏–ø—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
    const grouped = { bench: [], squat: [], deadlift: [], curl: [] };
    records.forEach(r => grouped[r.type]?.push(r));

    let leftCol = '';
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–æ –≤–µ—Å—É (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
    for (const key of ['bench', 'squat', 'deadlift', 'curl']) {
  leftCol += `<h3>${key === 'bench' ? '–ñ–∏–º –ª—ë–∂–∞' : key === 'squat' ? '–ü—Ä–∏—Å–µ–¥' : key === 'deadlift' ? '–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞' : key === 'curl' ? '–°—Ç—Ä–æ–≥–∏–π –±–∏—Ü–µ–ø—Å' : key
}</h3>`;
  if (!grouped[key].length) {
    leftCol += '<p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π.</p>';
    continue;
  }
  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤–µ—Å—É
  grouped[key].sort((a, b) => b.weight - a.weight);
  grouped[key].forEach((r, idx) => {
    const dateStr = new Date(r.date).toLocaleDateString();
    leftCol += `<p><b>${idx + 1}. ${r.name}</b>: ${r.weight} –∫–≥ (–¥–∞—Ç–∞: ${dateStr})</p>`;
  });
}

    // üí™ –ü–æ–¥—Å—á—ë—Ç —Å—É–º–º –ø–æ –∏–º–µ–Ω–∞–º —Å —É—á–µ—Ç–æ–º –≤–µ—Å–∞ —Ç–µ–ª–∞
    const totals = {}; // name -> {bench, squat, deadlift, bodyWeight}
    for (const record of records) {
      const { name, type, weight, bodyWeight } = record;
      if (!totals[name]) totals[name] = { bench: 0, squat: 0, deadlift: 0, bodyWeight: 0 };
      if (bodyWeight && bodyWeight > 0) {
        totals[name].bodyWeight = bodyWeight;
      }
      if (weight > (totals[name][type] || 0)) {
        totals[name][type] = weight;
      }
    }

    // –°—á–∏—Ç–∞–µ–º —Å—É–º–º—ã –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
    const totalArray = Object.entries(totals).map(([name, lifts]) => {
      const total = (lifts.bench || 0) + (lifts.squat || 0) + (lifts.deadlift || 0);
      const bodyWeight = lifts.bodyWeight || 1;
      const percent = (total / bodyWeight) * 100;
      return { name, total, percent };
    });

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–æ—Ü–µ–Ω—Ç—É (–æ—Ç –±–æ–ª—å—à–µ–≥–æ –∫ –º–µ–Ω—å—à–µ–º—É)
    totalArray.sort((a, b) => b.percent - a.percent);

    // –ü–æ—Å—Ç—Ä–æ–∏–º –ø—Ä–∞–≤—É—é –∫–æ–ª–æ–Ω–∫—É —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
    let rightCol = `<h3>üèÜ –°—É–º–º–∞ —Ç—Ä–æ–µ–±–æ—Ä—å—è</h3>`;
    totalArray.forEach((entry, index) => {
      rightCol += `<p><b>${index + 1}. ${entry.name}</b>: ${entry.total} –∫–≥ (${entry.percent.toFixed(1)}% –æ—Ç –≤–µ—Å–∞ —Ç–µ–ª–∞)</p>`;
    });

    // –í—ã–≤–æ–¥–∏–º –≤ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏
    container.innerHTML = `
      <div style="display: flex; flex-direction: row; gap: 40px; justify-content: center; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 300px;">${leftCol}</div>
        <div style="flex: 1; min-width: 300px;">${rightCol}</div>
      </div>
    `;

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–∫–æ—Ä–¥–æ–≤:', error);
    container.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö.';
  }
}


    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    selectMode(currentMode);
  </script>

  </body>
  </html>
  
