<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="manifest" href="manifest.json" />
<link rel="apple-touch-icon" href="icon.png" />
<title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–µ—Å–∞ —à—Ç–∞–Ω–≥–∏</title>
<style>
  :root {
    --bg-light: #fff;
    --text-light: #000;
    --bg-dark: #121212;
    --text-dark: #eee;
    --btn-bg-light: #000;
    --btn-bg-dark: #eee;
    --btn-text-light: #fff;
    --btn-text-dark: #000;
  }
  body {
    background: var(--bg-light);
    color: var(--text-light);
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
    text-align: center;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark {
    background: var(--bg-dark);
    color: var(--text-dark);
  }
  input[type=number], input[type=text] {
    padding: 12px 16px;
    font-size: 1.2em;
    width: 220px;
    border: 2px solid currentColor;
    border-radius: 14px;
    margin-bottom: 20px;
    outline: none;
    background: transparent;
    color: inherit;
  }
  button {
    background: var(--btn-bg-light);
    color: var(--btn-text-light);
    border: none;
    border-radius: 14px;
    padding: 14px 28px;
    font-size: 1.3em;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
  }
  body.dark button {
    background: var(--btn-bg-dark);
    color: var(--btn-text-dark);
  }
  button:hover {
    background: #444;
    color: #fff;
  }
  #result, #resultDetailed, #recordsList, #benchResults {
    margin-top: 30px;
    font-size: 1.3em;
    font-weight: 600;
    line-height: 1.4;
    white-space: pre-wrap;
  }
  #warning {
    margin-top: 15px;
    color: #b00000;
    font-weight: 700;
  }
  /* –ú–µ–Ω—é */
  .menu-button {
    position: fixed;
    top: 10px;
    left: 10px;
    font-size: 28px;
    cursor: pointer;
    user-select: none;
    z-index: 110;
  }
  #themeToggle {
    position: fixed;
    top: 10px;
    right: 10px;
    font-size: 24px;
    cursor: pointer;
    user-select: none;
    z-index: 110;
  }
  #sidebar {
    position: fixed;
    top: 0;
    left: -250px;
    width: 240px;
    height: 100%;
    background: #eee;
    box-shadow: 2px 0 5px rgba(0,0,0,0.2);
    padding: 20px;
    box-sizing: border-box;
    transition: left 0.3s;
    z-index: 100;
    overflow-y: auto;
  }
  body.dark #sidebar {
    background: #222;
    color: var(--text-dark);
  }
  #sidebar.open {
    left: 0;
  }
  #sidebar h2 {
    margin-top: 0;
  }
  #sidebar ul {
    list-style: none;
    padding: 0;
  }
  #sidebar ul li {
    padding: 10px 5px;
    cursor: pointer;
    border-radius: 8px;
  }
  #sidebar ul li:hover:not(.disabled) {
    background: #ccc;
  }
  #sidebar ul li.disabled {
    color: #888;
    cursor: default;
  }
  /* –û—Ç—Å—Ç—É–ø —É –∑–∞–≥–æ–ª–æ–≤–∫–∞, —á—Ç–æ–±—ã –º–µ–Ω—é –Ω–µ –Ω–∞–∫—Ä—ã–≤–∞–ª */
  h1 {
    margin-top: 60px;
  }
  /* –°–∫—Ä—ã–≤–∞—Ç—å disabled –ø—É–Ω–∫—Ç—ã –∫—É—Ä—Å–æ—Ä */
  #sidebar ul li.disabled:hover {
    background: none;
  }
  /* –§–æ—Ä–º–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ */
  #recordForm input, #recordForm select {
    width: 180px;
    margin: 5px;
  }
</style>
</head>
<body>

<div class="menu-button" onclick="toggleMenu()">‚ò∞</div>
<div id="themeToggle" onclick="toggleTheme()" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåû</div>

<div id="sidebar">
  <h2>–ú–µ–Ω—é</h2>
  <ul>
    <li onclick="selectMode('plates')">ü•û –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±–ª–∏–Ω–æ–≤</li>
    <li onclick="selectMode('bench')">üí™ –†–∞–∑–æ–≤—ã–π –∂–∏–º –ª—ë–∂–∞</li>
    <li onclick="selectMode('records')">üèÜ –õ–∏—á–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã</li>
  </ul>
</div>

<div id="modeContent">
</div>

<script>
  const plates = [20, 15, 10, 5, 2.5, 1.25];
  const maxPlatesPerType = 7;
  const barWeight = 20;

  let currentMode = 'plates';

  function toggleMenu() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('open');
  }

  function toggleTheme() {
    document.body.classList.toggle('dark');
    const themeToggle = document.getElementById('themeToggle');
    if(document.body.classList.contains('dark')){
      themeToggle.textContent = 'üåô';
    } else {
      themeToggle.textContent = 'üåû';
    }
  }

  function selectMode(mode) {
    currentMode = mode;
    toggleMenu();
    renderMode();
  }

  function renderMode() {
    const container = document.getElementById('modeContent');
    container.innerHTML = '';

    if(currentMode === 'plates'){
      container.innerHTML = `
        <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–µ—Å–∞ —à—Ç–∞–Ω–≥–∏</h1>
        <p>–í–≤–µ–¥–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π –≤–µ—Å (–≤ –∫–≥):</p>
        <input type="number" id="weightInput" min="${barWeight}" step="0.25" value="100" />
        <br/>
        <button id="platesBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –±–ª–∏–Ω—ã</button>
        <div id="warning"></div>
        <div id="result"></div>
        <div id="resultDetailed"></div>
      `;
      document.getElementById('platesBtn').addEventListener('click', calculatePlates);
    } else if(currentMode === 'bench'){
      container.innerHTML = `
        <h1>–†–∞—Å—á—ë—Ç —Ä–∞–∑–æ–≤–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ –≤ –∂–∏–º–µ –ª—ë–∂–∞</h1>
        <label>–í–µ—Å —à—Ç–∞–Ω–≥–∏ –≤ –∂–∏–º–µ –ª—ë–∂–∞: </label><br/>
        <input type="number" id="benchWeight" min="1" step="0.1" value="50" /> –∫–≥<br/><br/>
        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π —Å —ç—Ç–∏–º –≤–µ—Å–æ–º: </label><br/>
        <input type="number" id="benchReps" min="1" max="20" step="1" value="10" /> —Ä–∞–∑<br/><br/>
        <button id="benchBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
        <div id="benchResults"></div>
      `;
      document.getElementById('benchBtn').addEventListener('click', calculateBenchMax);
    } else if(currentMode === 'records'){
      container.innerHTML = `
        <h1>–õ–∏—á–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã</h1>
        <form id="recordForm">
          <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" required />
          <input type="number" id="recordWeight" placeholder="–í–µ—Å (–∫–≥)" min="1" required />
          <select id="exerciseType">
            <option value="bench">–ñ–∏–º –ª—ë–∂–∞</option>
            <option value="squat">–ü—Ä–∏—Å–µ–¥</option>
            <option value="deadlift">–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞</option>
          </select>
          <br/>
          <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥</button>
        </form>
        <div id="recordsList"></div>
      `;
      document.getElementById('recordForm').onsubmit = saveRecord;
      loadRecords();
    }
  }

  function calculatePlates() {
    document.getElementById('warning').textContent = "";
    document.getElementById('result').textContent = "";
    document.getElementById('resultDetailed').textContent = "";

    let target = parseFloat(document.getElementById('weightInput').value);
    if (isNaN(target) || target < barWeight) {
      document.getElementById('warning').textContent = `–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å —Å —É—á—ë—Ç–æ–º –≥—Ä–∏—Ñ–∞: ${barWeight} –∫–≥`;
      return;
    }

    let platesToUse = (target - barWeight) / 2;
    if (platesToUse < 0) {
      document.getElementById('warning').textContent = `–í–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω—å—à–µ ${barWeight} –∫–≥ (—Å–∞–º –≥—Ä–∏—Ñ).`;
      return;
    }

    let plateCounts = {};
    for (let p of plates) {
      plateCounts[p] = 0;
    }

    for (let p of plates) {
      while (platesToUse >= p - 0.0001 && plateCounts[p] < maxPlatesPerType) {
        platesToUse -= p;
        platesToUse = Math.round(platesToUse * 100) / 100; // –∏–∑–±–µ–≥–∞–µ–º –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç–µ–π
        plateCounts[p]++;
      }
    }

    if (platesToUse > 0.001) {
      document.getElementById('warning').textContent = "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ –Ω–∞–±—Ä–∞—Ç—å –∑–∞–¥–∞–Ω–Ω—ã–π –≤–µ—Å —Å —Ç–µ–∫—É—â–∏–º–∏ –±–ª–∏–Ω–∞–º–∏ (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 7 –±–ª–∏–Ω–æ–≤ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞).";
    }

    let resultText = `–î–ª—è –≤–µ—Å–∞ ${target} –∫–≥ –Ω–∞–¥–µ–Ω—å—Ç–µ –Ω–∞ –∫–∞–∂–¥—É—é —Å—Ç–æ—Ä–æ–Ω—É —à—Ç–∞–Ω–≥–∏:\n`;
    for (let p of plates) {
      if (plateCounts[p] > 0) {
        resultText += `${plateCounts[p]} x ${p} –∫–≥\n`;
      }
    }
    if(Object.values(plateCounts).every(c => c === 0)) {
      resultText += '–¢–æ–ª—å–∫–æ –≥—Ä–∏—Ñ (20 –∫–≥)';
    }

    document.getElementById('result').textContent = resultText;
  }

  function calculateBenchMax() {
    const M = parseFloat(document.getElementById('benchWeight').value);
    const k = parseInt(document.getElementById('benchReps').value);
    if (isNaN(M) || isNaN(k) || M <= 0 || k <= 0 || k > 20) {
      alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–µ—Å–∞ –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π (–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –æ—Ç 1 –¥–æ 20)');
      return;
    }

    const e = Math.E;

    const epley = (M * k) / 30 + M;
    const brzycki = M * (36 / (37 - k));
    const lander = (100 * M) / (101.3 - 2.67123 * k);
    const lombardi = M * Math.pow(k, 0.10);
    const mayhew = (100 * M) / (52.2 + 41.9 * Math.exp(-0.055 * k));
    const oconner = M * (1 + 0.025 * k);
    const wathan = (100 * M) / (48.8 + 53.8 * Math.exp(-0.075 * k));

    const formulas = {–≠–ø–ª–∏: epley, –ë–∂–∏—Ü–∫–∏: brzycki, –õ—ç–Ω–¥–µ—Ä–∞: lander, –õ–æ–º–±–∞—Ä–¥–∏: lombardi, –ú—ç–π—Ö—å—é: mayhew, "–û'–ö–æ–Ω–Ω–æ—Ä": oconner, –í–∞—Ç–∞–Ω–∞: wathan};

    let output = '';
    for (const [name, val] of Object.entries(formulas)) {
      output += `${name}: ${val.toFixed(2)} –∫–≥\n`;
    }

    const average = Object.values(formulas).reduce((a,b) => a+b, 0) / 7;
    output += `\n–°—Ä–µ–¥–Ω–∏–π –º–∞–∫—Å–∏–º—É–º: ${average.toFixed(2)} –∫–≥`;

    document.getElementById('benchResults').textContent = output;
  }

  // --- –†–µ–∫–æ—Ä–¥—ã ---
  function saveRecord(event) {
    event.preventDefault();
    const name = document.getElementById('name').value.trim();
    const weight = parseFloat(document.getElementById('recordWeight').value);
    const type = document.getElementById('exerciseType').value;
    if (!name || isNaN(weight) || weight <= 0) {
      alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.');
      return;
    }

    let records = JSON.parse(localStorage.getItem('records') || '[]');
    records.push({name, weight, type, date: new Date().toISOString()});
    localStorage.setItem('records', JSON.stringify(records));
    loadRecords();
    document.getElementById('recordForm').reset();
  }

  function loadRecords() {
    let records = JSON.parse(localStorage.getItem('records') || '[]');
    if (records.length === 0) {
      document.getElementById('recordsList').textContent = '–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤.';
      return;
    }
    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–∏–ø—É –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤–µ—Å—É
    let grouped = {bench: [], squat: [], deadlift: []};
    for (let r of records) {
      if (grouped[r.type]) {
        grouped[r.type].push(r);
      }
    }
    let output = '';
    for (let key of ['bench', 'squat', 'deadlift']) {
      output += `<h3>${key === 'bench' ? '–ñ–∏–º –ª—ë–∂–∞' : key === 'squat' ? '–ü—Ä–∏—Å–µ–¥' : '–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞'}</h3>`;
      if(grouped[key].length === 0) {
        output += '<p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π.</p>';
        continue;
      }
      grouped[key].sort((a,b) => b.weight - a.weight);
      for (let r of grouped[key]) {
        output += `<p>${r.name}: ${r.weight} –∫–≥ (–¥–∞—Ç–∞: ${new Date(r.date).toLocaleDateString()})</p>`;
      }
    }
    document.getElementById('recordsList').innerHTML = output;
  }

  renderMode();
</script>

</body>
</html>
