  <!DOCTYPE html>
  <html lang="ru">
  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon.png" />
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–µ—Å–∞ —à—Ç–∞–Ω–≥–∏</title>
  <style>
    :root {
      --bg-light: #fff;
      --text-light: #000;
      --bg-dark: #121212;
      --text-dark: #eee;
      --btn-bg-light: #000;
      --btn-bg-dark: #eee;
      --btn-text-light: #fff;
      --btn-text-dark: #000;
    }
    body {
      background: var(--bg-light);
      color: var(--text-light);
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      text-align: center;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }
    input[type=number], input[type=text] {
      padding: 12px 16px;
      font-size: 1.2em;
      width: 220px;
      border: 2px solid currentColor;
      border-radius: 14px;
      margin-bottom: 20px;
      outline: none;
      background: transparent;
      color: inherit;
    }
    button {
      background: var(--btn-bg-light);
      color: var(--btn-text-light);
      border: none;
      border-radius: 14px;
      padding: 14px 28px;
      font-size: 1.3em;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark button {
      background: var(--btn-bg-dark);
      color: var(--btn-text-dark);
    }
    button:hover {
      background: #444;
      color: #fff;
    }
    #result, #resultDetailed, #recordsList, #benchResults {
      margin-top: 30px;
      font-size: 1.3em;
      font-weight: 600;
      line-height: 1.4;
      white-space: pre-wrap;
    }
    #warning {
      margin-top: 15px;
      color: #b00000;
      font-weight: 700;
    } 
    /* –ú–µ–Ω—é */
    .menu-button {
      position: fixed;
      top: 10px;
      left: 10px;
      font-size: 28px;
      cursor: pointer;
      user-select: none;
      z-index: 110;
    }
    #themeToggle {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 24px;
      cursor: pointer;
      user-select: none;
      z-index: 110;
    }
    #sidebar {
      position: fixed;
      top: 0;
      left: -250px;
      width: 240px;
      height: 100%;
      background: #eee;
      box-shadow: 2px 0 5px rgba(0,0,0,0.2);
      padding: 20px;
      box-sizing: border-box;
      transition: left 0.3s;
      z-index: 100;
      overflow-y: auto;
    }
    body.dark #sidebar {
      background: #222;
      color: var(--text-dark);
    }
    #sidebar.open {
      left: 0;
    }
    #sidebar h2 {
      margin-top: 0;
    }
    #sidebar ul {
      list-style: none;
      padding: 0;
    }
    #sidebar ul li {
      padding: 10px 5px;
      cursor: pointer;
      border-radius: 8px;
    }
    #sidebar ul li:hover:not(.disabled) {
      background: #ccc;
    }
    #sidebar ul li.disabled {
      color: #888;
      cursor: default;
    }
    /* –û—Ç—Å—Ç—É–ø —É –∑–∞–≥–æ–ª–æ–≤–∫–∞, —á—Ç–æ–±—ã –º–µ–Ω—é –Ω–µ –Ω–∞–∫—Ä—ã–≤–∞–ª */
    h1 {
      margin-top: 60px;
    }
    /* –°–∫—Ä—ã–≤–∞—Ç—å disabled –ø—É–Ω–∫—Ç—ã –∫—É—Ä—Å–æ—Ä */
    #sidebar ul li.disabled:hover {
      background: none;
    }
    /* –§–æ—Ä–º–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ */
    #recordForm input, #recordForm select {
      width: 180px;
      margin: 5px;
    }
  </style>
  </head>
  <body>

  <div class="menu-button" onclick="toggleMenu()">‚ò∞</div>
  <div id="themeToggle" onclick="toggleTheme()" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåû</div>

  <div id="sidebar">
    <h2>–ú–µ–Ω—é</h2>
    <ul>
      <li onclick="selectMode('plates')">ü•û –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±–ª–∏–Ω–æ–≤</li>
      <li onclick="selectMode('bench')">üí™ –†–∞–∑–æ–≤—ã–π –∂–∏–º –ª—ë–∂–∞</li>
      <li onclick="selectMode('records')">üèÜ –õ–∏—á–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã</li>
    </ul>
  </div>

  <div id="modeContent">
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD7ZdXxWmSmth10PB4g3kbXtMASa_yLQrw",
      authDomain: "calculatorbench.firebaseapp.com",
      projectId: "calculatorbench",
      storageBucket: "calculatorbench.firebasestorage.app",
      messagingSenderId: "79133455556",
      appId: "1:79133455556:web:1ddc2a8df716d382fa4591"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <script>
    const plates = [20, 15, 10, 5, 2.5, 1.25];
    const maxPlatesPerType = 7;
    const barWeight = 20;

    let currentMode = 'plates';

    function toggleMenu() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('open');
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
      const themeToggle = document.getElementById('themeToggle');
      if(document.body.classList.contains('dark')){
        themeToggle.textContent = 'üåô';
      } else {
        themeToggle.textContent = 'üåû';
      }
    }

    function selectMode(mode) {
      currentMode = mode;
      toggleMenu();
      renderMode();
    }

    function renderMode() {
      const container = document.getElementById('modeContent');
      container.innerHTML = '';

      if(currentMode === 'plates'){
        container.innerHTML = `
          <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–µ—Å–∞ —à—Ç–∞–Ω–≥–∏</h1>
          <p>–í–≤–µ–¥–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π –≤–µ—Å (–≤ –∫–≥):</p>
          <input type="number" id="weightInput" min="${barWeight}" step="0.25" value="100" />
          <br/>
          <button id="platesBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –±–ª–∏–Ω—ã</button>
          <div id="warning"></div>
          <div id="result"></div>
          <div id="resultDetailed"></div>
        `;
        document.getElementById('platesBtn').addEventListener('click', calculatePlates);
      } else if(currentMode === 'bench'){
        container.innerHTML = `
          <h1>–†–∞—Å—á—ë—Ç —Ä–∞–∑–æ–≤–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ –≤ –∂–∏–º–µ –ª—ë–∂–∞</h1>
          <label>–í–µ—Å —à—Ç–∞–Ω–≥–∏ –≤ –∂–∏–º–µ –ª—ë–∂–∞: </label><br/>
          <input type="number" id="benchWeight" min="1" step="0.1" value="50" /> –∫–≥<br/><br/>
          <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π —Å —ç—Ç–∏–º –≤–µ—Å–æ–º: </label><br/>
          <input type="number" id="benchReps" min="1" max="20" step="1" value="10" /> —Ä–∞–∑<br/><br/>
          <button id="benchBtn">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
          <div id="benchResults"></div>
        `;
        document.getElementById('benchBtn').addEventListener('click', calculateBenchMax);
      } else if(currentMode === 'records'){
        container.innerHTML = `
          <h1>–õ–∏—á–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã</h1>
          <form id="recordForm">
            <input type="text" id="name" placeholder="–í–∞—à–µ –∏–º—è" required />
            <input type="number" id="recordWeight" placeholder="–í–µ—Å (–∫–≥)" min="1" required />
            <input type="number" id="bodyWeight" placeholder="–í–µ—Å —Ç–µ–ª–∞ (–∫–≥)" min="1" required />
            <select id="exerciseType">
              <option value="bench">–ñ–∏–º –ª—ë–∂–∞</option>
              <option value="squat">–ü—Ä–∏—Å–µ–¥</option>
              <option value="deadlift">–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞</option>
            </select>
            <br/>
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥</button>
          </form>
          <div id="recordsList"></div>
        `;
        

        document.getElementById('recordForm').onsubmit = saveRecord;
        loadRecords();
      }
    }

    function calculatePlates() {
      document.getElementById('warning').textContent = "";
      document.getElementById('result').textContent = "";
      document.getElementById('resultDetailed').textContent = "";

      let target = parseFloat(document.getElementById('weightInput').value);
      if (isNaN(target) || target < barWeight) {
        document.getElementById('warning').textContent = `–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å —Å —É—á—ë—Ç–æ–º –≥—Ä–∏—Ñ–∞: ${barWeight} –∫–≥`;
        return;
      }

      let platesToUse = (target - barWeight) / 2; // –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
      if (platesToUse < 0) {
        document.getElementById('warning').textContent = "–í–µ—Å –º–µ–Ω—å—à–µ –≤–µ—Å–∞ –≥—Ä–∏—Ñ–∞!";
        return;
      }

      let plateCount = {};
      for (const plate of plates) {
        plateCount[plate] = 0;
      }

      for (const plate of plates) {
        while (platesToUse >= plate - 0.001 && plateCount[plate] < maxPlatesPerType) {
          platesToUse -= plate;
          plateCount[plate]++;
        }
      }

      if (platesToUse > 0.001) {
        document.getElementById('warning').textContent = "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ –Ω–∞–±—Ä–∞—Ç—å –∑–∞–¥–∞–Ω–Ω—ã–π –≤–µ—Å –±–ª–∏–Ω–∞–º–∏.";
      }

      let result = Object.entries(plateCount)
        .filter(([_, c]) => c > 0)
        .map(([p, c]) => `${c} x ${p} –∫–≥`)
        .join(", ");

      if (!result) result = "–¢–æ–ª—å–∫–æ –≥—Ä–∏—Ñ ‚Äî " + barWeight + " –∫–≥";

      document.getElementById('result').textContent = `–ù—É–∂–Ω–æ –Ω–∞–¥–µ—Ç—å –±–ª–∏–Ω—ã —Å –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã:\n${result}`;
      document.getElementById('resultDetailed').textContent = `–û–±—â–∏–π –≤–µ—Å: ${target} –∫–≥ (–≥—Ä–∏—Ñ ${barWeight} –∫–≥ + –±–ª–∏–Ω—ã –ø–æ –æ–±–µ–∏–º —Å—Ç–æ—Ä–æ–Ω–∞–º)`;
    }

    // –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á—ë—Ç–∞ 1–ü–ú –≤ –∂–∏–º–µ –ª—ë–∂–∞
    function calculateBenchMax() {
      const weight = parseFloat(document.getElementById('benchWeight').value);
      const reps = parseInt(document.getElementById('benchReps').value);
      if(isNaN(weight) || isNaN(reps) || weight <= 0 || reps <= 0){
        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!');
        return;
      }

      const formulas = {
        Epley: weight * (1 + reps / 30),
        Lombardi: weight * Math.pow(reps, 0.10),
        OConner: weight * (1 + reps / 40),
        Mayhew: (100 * weight) / (52.2 + 41.9 * Math.exp(-0.055 * reps)),
        Wathan: (100 * weight) / (48.8 + 53.8 * Math.exp(-0.075 * reps)),
        Schwartz: weight * (1 + reps / 30),
        Lander: (100 * weight) / (101.3 - 2.67123 * reps)
      };

      let resStr = "–†–∞—Å—á—ë—Ç –æ–¥–Ω–æ–ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –º–∞–∫—Å–∏–º—É–º–∞ (–∫–≥):\n";
      for(const f in formulas){
        resStr += `${f}: ${formulas[f].toFixed(1)}\n`;
      }
      document.getElementById('benchResults').textContent = resStr;
    }

    // Firestore ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥
      async function saveRecord(e) {
  e.preventDefault();  // —á—Ç–æ–±—ã —Ñ–æ—Ä–º–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞—Å—å –∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–ª–∞—Å—å

  const name = document.getElementById('name').value.trim();
  const weight = parseFloat(document.getElementById('recordWeight').value);
  const bodyWeight = parseFloat(document.getElementById('bodyWeight').value);
  const type = document.getElementById('exerciseType').value;

  // –í–æ—Ç —Ç—É—Ç –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É:
  if (!name || isNaN(weight) || weight <= 0 || isNaN(bodyWeight) || bodyWeight <= 0) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π.');
    return;  // –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–≤–µ—Ä–Ω—ã–µ
  }

  // –î–∞–ª–µ–µ –∏–¥–µ—Ç –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑—É
  try {
    await db.collection('records').add({
      name,
      weight,
      bodyWeight,
      type,
      date: new Date().toISOString(),
    });
    alert('–†–µ–∫–æ—Ä–¥ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
  } catch (error) {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∫–æ—Ä–¥–∞: ' + error.message);
  }
}

    // Firestore ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã
    async function loadRecords() {
  const container = document.getElementById('recordsList');
  container.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞...';

  try {
    const snapshot = await db.collection('records').get();
    const records = snapshot.docs.map(doc => doc.data());

    if (records.length === 0) {
      container.textContent = '–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ä–µ–∫–æ—Ä–¥–æ–≤.';
      return;
    }

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Ç–∏–ø—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
    const grouped = { bench: [], squat: [], deadlift: [] };
    records.forEach(r => grouped[r.type]?.push(r));

    let leftCol = '';
    for (const key of ['bench', 'squat', 'deadlift']) {
      leftCol += `<h3>${key === 'bench' ? '–ñ–∏–º –ª—ë–∂–∞' : key === 'squat' ? '–ü—Ä–∏—Å–µ–¥' : '–°—Ç–∞–Ω–æ–≤–∞—è —Ç—è–≥–∞'}</h3>`;
      if (!grouped[key].length) {
        leftCol += '<p>–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π.</p>';
        continue;
      }
      for (const r of grouped[key]) {
        const dateStr = new Date(r.date).toLocaleDateString();
        leftCol += `<p><b>${r.name}</b>: ${r.weight} –∫–≥ (–¥–∞—Ç–∞: ${dateStr})</p>`;
      }
    }

    // üí™ –ü–æ–¥—Å—á—ë—Ç —Å—É–º–º –ø–æ –∏–º–µ–Ω–∞–º —Å —É—á–µ—Ç–æ–º –≤–µ—Å–∞ —Ç–µ–ª–∞
    const totals = {}; // name -> {bench, squat, deadlift, bodyWeight}

    for (const record of records) {
      const { name, type, weight, bodyWeight } = record;
      if (!totals[name]) totals[name] = { bench: 0, squat: 0, deadlift: 0, bodyWeight: 0 };

      // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º –≤–µ—Å —Ç–µ–ª–∞ (–±–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –Ω–µ–ø—É—Å—Ç–æ–π)
      if (bodyWeight && bodyWeight > 0) {
        totals[name].bodyWeight = bodyWeight;
      }

      // –¢–æ–ª—å–∫–æ –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –∫–∞–∂–¥–æ–º—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é
      if (weight > (totals[name][type] || 0)) {
        totals[name][type] = weight;
      }
    }

    // –°—á–∏—Ç–∞–µ–º —Å—É–º–º—ã –∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã
    const totalArray = Object.entries(totals).map(([name, lifts]) => {
      const total = (lifts.bench || 0) + (lifts.squat || 0) + (lifts.deadlift || 0);
      const bodyWeight = lifts.bodyWeight || 1; // —á—Ç–æ–±—ã –Ω–µ –¥–µ–ª–∏—Ç—å –Ω–∞ 0
      const percent = (total / bodyWeight) * 100;

      return { name, total, percent };
    });

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—É–º–º–µ
    totalArray.sort((a, b) => b.total - a.total);

    // –ü–æ—Å—Ç—Ä–æ–∏–º –ø—Ä–∞–≤—É—é –∫–æ–ª–æ–Ω–∫—É —Å –ø—Ä–æ—Ü–µ–Ω—Ç–∞–º–∏
    let rightCol = `<h3>üèÜ –°—É–º–º–∞ —Ç—Ä–æ–µ–±–æ—Ä—å—è</h3>`;
    totalArray.forEach((entry, index) => {
      rightCol += `<p><b>${index + 1}. ${entry.name}</b>: ${entry.total} –∫–≥ (${entry.percent.toFixed(1)}% –æ—Ç –≤–µ—Å–∞ —Ç–µ–ª–∞)</p>`;
    });

    // –í—ã–≤–æ–¥–∏–º –≤ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏
    container.innerHTML = `
      <div style="display: flex; flex-direction: row; gap: 40px; justify-content: center; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 300px;">${leftCol}</div>
        <div style="flex: 1; min-width: 300px;">${rightCol}</div>
      </div>
    `;

  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–∫–æ—Ä–¥–æ–≤:', error);
    container.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö.';
  }
}


    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    selectMode(currentMode);
  </script>

  </body>
  </html>
